<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marketa Mía - Tu Minisuper de Confianza</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Manrope:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <style>
        :root {
            --bg-light: #FFFFFF;
            --bg-dark: #111827;
            --text-light: #F9FAFB;
            --text-dark: #1F2937;
            --primary: #059669; /* Darker, high-contrast Emerald */
            --primary-dark: #047857;
            --secondary: #FBBF24; /* Amber/Gold */
        }
        body {
            font-family: 'Manrope', sans-serif;
            background-color: var(--bg-light);
            color: var(--text-dark);
        }
        .font-serif {
            font-family: 'Playfair Display', serif;
        }
        .btn {
            transition: all 0.3s ease;
        }
        .btn-primary {
            background-color: var(--primary);
            color: white;
            box-shadow: 0 4px 14px 0 rgba(5, 150, 105, 0.25);
        }
        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px 0 rgba(5, 150, 105, 0.3);
        }
        .card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-10px);
            box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25);
        }
        /* Chatbot Styles */
        #chatbot-container {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        .chat-bubble-user {
            background-color: var(--primary);
            color: white;
        }
        .chat-bubble-bot {
            background-color: #e5e7eb;
            color: var(--text-dark);
        }
        .quick-reply-btn {
            background-color: white;
            border: 1px solid #d1d5db;
            color: var(--primary-dark);
            padding: 8px 12px;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .quick-reply-btn:hover {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        .typing-indicator span {
            height: 8px;
            width: 8px;
            background-color: #9ca3af;
            display: inline-block;
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }
        /* Animation initial state */
        .fade-in-up {
            opacity: 0;
            transform: translateY(30px);
        }
        /* Chatbot trigger animation */
        #chatbot-trigger {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(5, 150, 105, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(5, 150, 105, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(5, 150, 105, 0); }
        }
    </style>
</head>
<body class="antialiased">

    <!-- Header -->
    <header class="bg-white/95 backdrop-blur-lg shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#">
                <img src="https://i.imgur.com/GOcxFa1.png" alt="Logo de Marketa Mía" class="h-12 w-auto">
            </a>
            <div class="hidden lg:flex items-center space-x-8 font-semibold">
                <a href="#historia" class="text-gray-700 hover:text-primary transition">Nosotros</a>
                <a href="#productos" class="text-gray-700 hover:text-primary transition">Productos</a>
                <a href="#sucursales" class="text-gray-700 hover:text-primary transition">Sucursales</a>
                <a href="#contacto" class="btn btn-primary px-6 py-2.5 rounded-full text-sm font-bold">Contacto</a>
            </div>
            <button id="mobile-menu-button" class="lg:hidden text-primary">
                <i data-lucide="menu" class="w-7 h-7"></i>
            </button>
        </nav>
        <div id="mobile-menu" class="hidden lg:hidden bg-white px-6 pb-4 border-t">
            <a href="#historia" class="block py-2 text-gray-700 hover:text-primary">Nosotros</a>
            <a href="#productos" class="block py-2 text-gray-700 hover:text-primary">Productos</a>
            <a href="#sucursales" class="block py-2 text-gray-700 hover:text-primary">Sucursales</a>
            <a href="#contacto" class="block mt-2 bg-primary text-white px-4 py-2 rounded-full text-center">Contacto</a>
        </div>
    </header>

    <main>
        <!-- Hero Section -->
        <section class="relative h-[85vh] flex items-center justify-center text-white overflow-hidden">
            <div class="absolute inset-0 z-0">
                <video autoplay loop muted playsinline class="w-full h-full object-cover">
                    <source src="https://i.imgur.com/pvl0uXO.mp4" type="video/mp4">
                    Tu navegador no soporta el video de fondo.
                </video>
                <div class="absolute inset-0 bg-black/60"></div> <!-- Overlay for better text readability -->
            </div>
            <div class="container mx-auto px-6 text-center relative z-10">
                <h1 class="font-serif text-5xl md:text-7xl font-bold leading-tight mb-4">Calidad que se siente, <span style="color: var(--primary);">frescura que se vive.</span></h1>
                <p class="text-lg md:text-xl text-gray-300 mb-8 max-w-3xl mx-auto">Redefinimos la experiencia de compra con productos de la más alta calidad y un servicio que te hace sentir en casa.</p>
                <a href="#productos" class="btn btn-primary font-bold px-10 py-4 rounded-full text-lg">Explorar productos</a>
            </div>
        </section>

        <!-- Historia, Misión, Visión y Valores -->
        <section id="historia" class="py-24 bg-white">
            <div class="container mx-auto px-6">
                <div class="text-center mb-16">
                    <h2 class="fade-in-up font-serif text-4xl md:text-5xl font-bold">Nuestra Esencia</h2>
                    <p class="fade-in-up text-lg text-gray-600 mt-4 max-w-2xl mx-auto">El corazón y el alma de Marketa Mía.</p>
                </div>
                <div class="grid lg:grid-cols-2 gap-16 items-center mb-16">
                    <div class="fade-in-up">
                        <img src="https://placehold.co/800x600/F9FAFB/1F2937?text=Historia" class="rounded-xl shadow-lg">
                    </div>
                    <div class="fade-in-up">
                        <h3 class="font-serif text-3xl font-bold mb-4" style="color: var(--primary);">Nuestra Historia</h3>
                        <p class="text-gray-700 leading-relaxed">Marketa Mía nació en 2015 con un objetivo claro: ser más que un minisuper. Queríamos crear un espacio donde la comunidad pudiera encontrar productos de alta calidad con la confianza y el trato amable de la tienda de la esquina. Lo que comenzó como un pequeño local familiar, hoy se ha expandido a tres sucursales, pero nuestro corazón sigue siendo el mismo: servir a nuestros vecinos con lo mejor.</p>
                    </div>
                </div>
                <div class="grid md:grid-cols-3 gap-8">
                    <div class="card bg-light-gray p-8 rounded-lg text-center fade-in-up">
                        <div class="bg-emerald-100 text-primary w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i data-lucide="rocket" class="w-10 h-10"></i>
                        </div>
                        <h3 class="font-serif font-bold text-xl mb-2">Misión</h3>
                        <p class="text-gray-600">Ofrecer una experiencia de compra práctica y amigable, garantizando productos de alta calidad a precios justos.</p>
                    </div>
                    <div class="card bg-light-gray p-8 rounded-lg text-center fade-in-up">
                        <div class="bg-emerald-100 text-primary w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i data-lucide="eye" class="w-10 h-10"></i>
                        </div>
                        <h3 class="font-serif font-bold text-xl mb-2">Visión</h3>
                        <p class="text-gray-600">Ser el minisuper preferido en cada barrio, reconocidos por nuestra calidad, servicio y conexión con la comunidad.</p>
                    </div>
                    <div class="card bg-light-gray p-8 rounded-lg text-center fade-in-up">
                        <div class="bg-emerald-100 text-primary w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i data-lucide="gem" class="w-10 h-10"></i>
                        </div>
                        <h3 class="font-serif font-bold text-xl mb-2">Valores</h3>
                        <p class="text-gray-600">Calidad, Confianza, Servicio y Comunidad.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Canasta Básica Section -->
        <section id="productos" class="py-24 bg-light-gray">
            <div class="container mx-auto px-6">
                <div class="text-center mb-16">
                    <h2 class="fade-in-up font-serif text-4xl md:text-5xl font-bold">Canasta Básica y Ofertas</h2>
                    <p class="fade-in-up text-lg text-gray-600 mt-4 max-w-2xl mx-auto">Lo esencial para tu hogar, siempre al mejor precio.</p>
                </div>
                <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-6">
                    <!-- Artículos de la Canasta Básica -->
                    <div class="card bg-white p-4 rounded-lg text-center group fade-in-up">
                        <img src="https://placehold.co/400x400/fef08a/422006?text=Huevo" class="w-full h-32 object-cover rounded-md mb-4">
                        <h3 class="font-semibold">Huevo Blanco (18 pzas)</h3>
                        <p class="font-bold text-primary text-lg">$45.00</p>
                    </div>
                    <div class="card bg-white p-4 rounded-lg text-center group fade-in-up relative overflow-hidden">
                        <div class="absolute top-2 -left-10 transform -rotate-45 bg-secondary text-dark text-xs font-bold px-10 py-1">OFERTA</div>
                        <img src="https://placehold.co/400x400/3b82f6/FFFFFF?text=Leche" class="w-full h-32 object-cover rounded-md mb-4">
                        <h3 class="font-semibold">Leche Entera 1L</h3>
                        <p class="font-bold text-primary text-lg">$22.50</p>
                    </div>
                    <div class="card bg-white p-4 rounded-lg text-center group fade-in-up">
                        <img src="https://placehold.co/400x400/f97316/FFFFFF?text=Frijol" class="w-full h-32 object-cover rounded-md mb-4">
                        <h3 class="font-semibold">Frijol Negro (1kg)</h3>
                        <p class="font-bold text-primary text-lg">$32.00</p>
                    </div>
                    <div class="card bg-white p-4 rounded-lg text-center group fade-in-up">
                        <img src="https://placehold.co/400x400/f3f4f6/1f2937?text=Arroz" class="w-full h-32 object-cover rounded-md mb-4">
                        <h3 class="font-semibold">Arroz Blanco (1kg)</h3>
                        <p class="font-bold text-primary text-lg">$28.50</p>
                    </div>
                    <div class="card bg-white p-4 rounded-lg text-center group fade-in-up">
                        <img src="https://placehold.co/400x400/eab308/FFFFFF?text=Aceite" class="w-full h-32 object-cover rounded-md mb-4">
                        <h3 class="font-semibold">Aceite Vegetal (1L)</h3>
                        <p class="font-bold text-primary text-lg">$42.00</p>
                    </div>
                    <div class="card bg-white p-4 rounded-lg text-center group fade-in-up">
                        <img src="https://placehold.co/400x400/d1d5db/4b5563?text=Azúcar" class="w-full h-32 object-cover rounded-md mb-4">
                        <h3 class="font-semibold">Azúcar Estándar (1kg)</h3>
                        <p class="font-bold text-primary text-lg">$38.00</p>
                    </div>
                    <div class="card bg-white p-4 rounded-lg text-center group fade-in-up">
                        <img src="https://placehold.co/400x400/ca8a04/FFFFFF?text=Tortillas" class="w-full h-32 object-cover rounded-md mb-4">
                        <h3 class="font-semibold">Tortillas de Maíz (1kg)</h3>
                        <p class="font-bold text-primary text-lg">$24.00</p>
                    </div>
                    <div class="card bg-white p-4 rounded-lg text-center group fade-in-up relative overflow-hidden">
                        <div class="absolute top-2 -left-10 transform -rotate-45 bg-secondary text-dark text-xs font-bold px-10 py-1">OFERTA</div>
                        <img src="https://placehold.co/400x400/ef4444/FFFFFF?text=Pollo" class="w-full h-32 object-cover rounded-md mb-4">
                        <h3 class="font-semibold">Pechuga de Pollo (kg)</h3>
                        <p class="font-bold text-primary text-lg">$119.00</p>
                    </div>
                    <div class="card bg-white p-4 rounded-lg text-center group fade-in-up">
                        <img src="https://placehold.co/400x400/dc2626/FFFFFF?text=Jitomate" class="w-full h-32 object-cover rounded-md mb-4">
                        <h3 class="font-semibold">Jitomate Saladet (kg)</h3>
                        <p class="font-bold text-primary text-lg">$29.90</p>
                    </div>
                    <div class="card bg-white p-4 rounded-lg text-center group fade-in-up">
                        <img src="https://placehold.co/400x400/e2e8f0/475569?text=Cebolla" class="w-full h-32 object-cover rounded-md mb-4">
                        <h3 class="font-semibold">Cebolla Blanca (kg)</h3>
                        <p class="font-bold text-primary text-lg">$25.00</p>
                    </div>
                    <div class="card bg-white p-4 rounded-lg text-center group fade-in-up">
                        <img src="https://placehold.co/400x400/d97706/FFFFFF?text=Papa" class="w-full h-32 object-cover rounded-md mb-4">
                        <h3 class="font-semibold">Papa Blanca (kg)</h3>
                        <p class="font-bold text-primary text-lg">$27.50</p>
                    </div>
                    <div class="card bg-white p-4 rounded-lg text-center group fade-in-up">
                        <img src="https://placehold.co/400x400/84cc16/FFFFFF?text=Limón" class="w-full h-32 object-cover rounded-md mb-4">
                        <h3 class="font-semibold">Limón con Semilla (kg)</h3>
                        <p class="font-bold text-primary text-lg">$35.00</p>
                    </div>
                    <div class="card bg-white p-4 rounded-lg text-center group fade-in-up">
                        <img src="https://placehold.co/400x400/a855f7/FFFFFF?text=Pan" class="w-full h-32 object-cover rounded-md mb-4">
                        <h3 class="font-semibold">Pan de Caja Blanco</h3>
                        <p class="font-bold text-primary text-lg">$45.00</p>
                    </div>
                    <div class="card bg-white p-4 rounded-lg text-center group fade-in-up">
                        <img src="https://placehold.co/400x400/14b8a6/FFFFFF?text=Jabón" class="w-full h-32 object-cover rounded-md mb-4">
                        <h3 class="font-semibold">Jabón de Baño (pza)</h3>
                        <p class="font-bold text-primary text-lg">$15.00</p>
                    </div>
                    <div class="card bg-white p-4 rounded-lg text-center group fade-in-up">
                        <img src="https://placehold.co/400x400/64748b/FFFFFF?text=Atún" class="w-full h-32 object-cover rounded-md mb-4">
                        <h3 class="font-semibold">Atún en Aceite (lata)</h3>
                        <p class="font-bold text-primary text-lg">$21.00</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sucursales con Mapa -->
        <section id="sucursales" class="py-24 bg-white">
            <div class="container mx-auto px-6">
                <div class="text-center mb-16">
                    <h2 class="fade-in-up font-serif text-4xl md:text-5xl font-bold">Nuestras Sucursales</h2>
                </div>
                <div class="grid md:grid-cols-5 gap-8">
                    <div class="md:col-span-3 fade-in-up">
                        <img src="https://placehold.co/1200x800/e0e0e0/666666?text=Mapa+de+Sucursales+en+Jalisco" alt="Mapa de sucursales" class="w-full h-full min-h-[400px] object-cover rounded-xl shadow-lg">
                    </div>
                    <div class="md:col-span-2 space-y-6">
                        <div class="card bg-light-gray p-6 rounded-lg shadow-md fade-in-up">
                            <h3 class="font-serif font-bold text-xl mb-3" style="color: var(--primary);">Marketa Mía Monteverde</h3>
                            <p class="text-gray-600 flex items-start mb-4"><i data-lucide="map-pin" class="w-5 h-5 mr-2 mt-1 flex-shrink-0"></i>BOULEVARD SENDEROS DE MONTEVERDE 25 LOCALES 3 Y 4, 45646 JALISCO</p>
                            <a href="https://wa.me/5213338159036" target="_blank" class="btn bg-green-500 text-white font-bold py-2 px-4 rounded-full inline-flex items-center text-sm hover:bg-green-600"><i data-lucide="message-circle" class="w-4 h-4 mr-2"></i>WhatsApp</a>
                        </div>
                        <div class="card bg-light-gray p-6 rounded-lg shadow-md fade-in-up">
                            <h3 class="font-serif font-bold text-xl mb-3" style="color: var(--primary);">Marketa Mía Valle de las Flores</h3>
                            <p class="text-gray-600 flex items-start mb-4"><i data-lucide="map-pin" class="w-5 h-5 mr-2 mt-1 flex-shrink-0"></i>LOPEZ MATEOS SUR 111111 VALLE DE LAS FLORES, 45640, JALISCO</p>
                            <a href="https://wa.me/5213320958489" target="_blank" class="btn bg-green-500 text-white font-bold py-2 px-4 rounded-full inline-flex items-center text-sm hover:bg-green-600"><i data-lucide="message-circle" class="w-4 h-4 mr-2"></i>WhatsApp</a>
                        </div>
                        <div class="card bg-light-gray p-6 rounded-lg shadow-md fade-in-up">
                            <h3 class="font-serif font-bold text-xl mb-3" style="color: var(--primary);">Marketa Mía Providencia</h3>
                            <p class="text-gray-600 flex items-start mb-4"><i data-lucide="map-pin" class="w-5 h-5 mr-2 mt-1 flex-shrink-0"></i>AV PABLO NERUDA #2120 COL PROVIDENCIA JALISCO</p>
                            <a href="https://wa.me/5213339480011" target="_blank" class="btn bg-green-500 text-white font-bold py-2 px-4 rounded-full inline-flex items-center text-sm hover:bg-green-600"><i data-lucide="message-circle" class="w-4 h-4 mr-2"></i>WhatsApp</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Contacto Section -->
        <section id="contacto" class="py-24 bg-light-gray">
            <div class="container mx-auto px-6">
                <div class="bg-white rounded-2xl shadow-xl p-8 md:p-16 text-center relative overflow-hidden">
                     <div class="absolute -top-16 -right-16 text-primary opacity-10">
                        <i data-lucide="message-circle" class="w-64 h-64"></i>
                    </div>
                    <div class="relative z-10">
                        <h2 class="font-serif text-4xl md:text-5xl font-extrabold mb-4 text-dark">¿Tienes alguna duda?</h2>
                        <p class="text-lg text-gray-600 mb-8 max-w-2xl mx-auto">Nuestro asistente virtual está disponible 24/7 para ayudarte con horarios, sucursales o productos. ¡Pruébalo!</p>
                        <button id="open-chatbot-btn" class="btn bg-secondary text-dark font-bold py-4 px-10 rounded-full inline-flex items-center space-x-3 text-lg hover:opacity-90 transition-opacity">
                            <i data-lucide="bot" class="w-6 h-6"></i>
                            <span>Chatear con Asistente Virtual</span>
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-dark text-white py-12">
        <div class="container mx-auto px-6">
            <div class="grid md:grid-cols-4 gap-8 mb-8">
                <div>
                    <a href="#">
                        <img src="https://i.imgur.com/GOcxFa1.png" alt="Logo de Marketa Mía" class="h-10 w-auto mb-4">
                    </a>
                    <p class="text-gray-400">Tu minisuper de confianza.</p>
                </div>
                <div>
                    <h3 class="font-bold text-lg mb-4">Navegación</h3>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="#productos" class="hover:text-white">Productos</a></li>
                        <li><a href="#historia" class="hover:text-white">Historia</a></li>
                        <li><a href="#sucursales" class="hover:text-white">Sucursales</a></li>
                    </ul>
                </div>
                 <div>
                    <h3 class="font-bold text-lg mb-4">Ayuda</h3>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="#" class="hover:text-white">Preguntas Frecuentes</a></li>
                        <li><a href="#contacto" class="hover:text-white">Contacto</a></li>
                    </ul>
                </div>
                 <div>
                    <h3 class="font-bold text-lg mb-4">Síguenos</h3>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-white"><i data-lucide="instagram"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white"><i data-lucide="facebook"></i></a>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-700 pt-8 text-center text-gray-500">
                <p>&copy; 2024 Marketa Mía. Todos los derechos reservados.</p>
                <p class="text-xs mt-2">Powered by <a href="#" class="hover:text-white font-semibold">weavy.agency</a></p>
            </div>
        </div>
    </footer>

    <!-- Chatbot -->
    <div id="chatbot-trigger" class="fixed bottom-6 right-6 bg-primary rounded-full p-2 cursor-pointer shadow-lg hover:bg-primary-dark transition-all duration-300 transform hover:scale-110">
        <img src="https://i.imgur.com/GOcxFa1.png" alt="Asistente Virtual" class="w-12 h-12">
    </div>

    <div id="chatbot-container" class="fixed bottom-24 right-6 w-80 h-[28rem] bg-white rounded-xl shadow-2xl flex flex-col hidden opacity-0 -translate-y-4">
        <div class="bg-primary text-white p-4 flex justify-between items-center rounded-t-xl">
            <div class="flex items-center space-x-3">
                <div class="bg-white/30 p-1 rounded-full"><i data-lucide="bot" class="w-6 h-6"></i></div>
                <h3 class="font-bold">Asistente Virtual</h3>
            </div>
            <button id="close-chatbot" class="text-white hover:opacity-75">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
        </div>
        <div id="chat-messages" class="flex-1 p-4 overflow-y-auto space-y-4">
            <!-- Initial message will be added by JS -->
        </div>
        <div class="p-2 border-t border-gray-200 text-center text-xs text-gray-400">
            Powered by <span class="font-semibold">weavy.agency</span>
        </div>
        <form id="chat-form" class="p-4 border-t border-gray-200 flex items-center">
            <input id="chat-input" type="text" placeholder="Escribe tu pregunta..." class="w-full px-3 py-2 border rounded-l-md focus:outline-none focus:ring-2 focus:ring-primary">
            <button type="submit" class="bg-primary text-white p-2 rounded-r-md hover:bg-primary-dark">
                <i data-lucide="send" class="w-6 h-6"></i>
            </button>
        </form>
    </div>

    <script>
        lucide.createIcons();
        gsap.registerPlugin(ScrollTrigger);
        
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        mobileMenuButton.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
        document.querySelectorAll('#mobile-menu a, nav a').forEach(link => {
            link.addEventListener('click', (e) => {
                if(link.getAttribute('href').startsWith('#')) {
                    e.preventDefault();
                    document.querySelector(link.getAttribute('href')).scrollIntoView({ behavior: 'smooth' });
                    if(!mobileMenu.classList.contains('hidden')) {
                         mobileMenu.classList.add('hidden');
                    }
                }
            });
        });

        // GSAP Animations
        gsap.utils.toArray('.fade-in-up').forEach(elem => {
            gsap.fromTo(elem, 
                { opacity: 0, y: 30 }, 
                {
                    opacity: 1,
                    y: 0,
                    duration: 1,
                    ease: 'power3.out',
                    scrollTrigger: {
                        trigger: elem,
                        start: 'top 90%',
                        toggleActions: 'play none none none',
                    }
                }
            );
        });

        // Chatbot Logic
        const chatbotTrigger = document.getElementById('chatbot-trigger');
        const chatbotContainer = document.getElementById('chatbot-container');
        const closeChatbot = document.getElementById('close-chatbot');
        const chatForm = document.getElementById('chat-form');
        const chatInput = document.getElementById('chat-input');
        const chatMessages = document.getElementById('chat-messages');
        const openChatbotBtn = document.getElementById('open-chatbot-btn');

        const toggleChatbot = () => {
            chatbotContainer.classList.toggle('hidden');
            if (!chatbotContainer.classList.contains('hidden')) {
                chatbotContainer.style.opacity = '1';
                chatbotContainer.style.transform = 'translateY(0)';
            } else {
                chatbotContainer.style.opacity = '0';
                chatbotContainer.style.transform = 'translateY(1rem)';
            }
        };

        chatbotTrigger.addEventListener('click', toggleChatbot);
        closeChatbot.addEventListener('click', toggleChatbot);
        openChatbotBtn.addEventListener('click', toggleChatbot);

        const storeInfo = {
            monteverde: { name: "Marketa Mía Monteverde", phone: "5213338159036" },
            flores: { name: "Marketa Mía Valle de las Flores", phone: "5213320958489" },
            providencia: { name: "Marketa Mía Providencia", phone: "5213339480011" }
        };

        const addMessage = (message, sender, quickReplies = []) => {
            const bubble = document.createElement('div');
            bubble.className = `max-w-xs p-3 rounded-lg ${sender === 'user' ? 'chat-bubble-user self-end' : 'chat-bubble-bot self-start'}`;
            
            let content = message.replace(/\n/g, '<br>');
            if (quickReplies.length > 0) {
                content += '<div class="flex flex-wrap gap-2 mt-3">';
                quickReplies.forEach(reply => {
                    content += `<button class="quick-reply-btn" data-value="${reply.value}">${reply.label}</button>`;
                });
                content += '</div>';
            }
            bubble.innerHTML = content;
            chatMessages.appendChild(bubble);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        };
        
        chatMessages.addEventListener('click', (e) => {
            if (e.target.classList.contains('quick-reply-btn')) {
                const value = e.target.dataset.value;
                handleUserInput(value, true); // Pass true to indicate it's a quick reply
            }
        });

        const showTypingIndicator = () => {
            const typingBubble = document.createElement('div');
            typingBubble.id = 'typing-indicator';
            typingBubble.className = 'chat-bubble-bot self-start max-w-xs p-3 rounded-lg';
            typingBubble.innerHTML = `<div class="typing-indicator"><span></span><span></span><span></span></div>`;
            chatMessages.appendChild(typingBubble);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        };

        const removeTypingIndicator = () => {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) indicator.remove();
        };

        const getBotResponse = async (userMessage) => {
            const lowerCaseInput = userMessage.toLowerCase();
            
            const storeKeywords = Object.keys(storeInfo);
            for (const key of storeKeywords) {
                if (lowerCaseInput.includes(key)) {
                    const store = storeInfo[key];
                    return {
                        message: `<p>Perfecto. Haz clic aquí para chatear con ${store.name}:</p>
                                  <a href="https://wa.me/${store.phone}?text=Hola%20${encodeURIComponent(store.name)}" target="_blank" class="block bg-green-500 text-white font-bold py-2 px-4 rounded-lg mt-2 text-center">Chatear en WhatsApp</a>`,
                        quickReplies: []
                    };
                }
            }
            
            if (lowerCaseInput.includes('whatsapp') || lowerCaseInput.includes('contacto')) {
                return {
                    message: "¡Claro! ¿Con qué sucursal te gustaría comunicarte?",
                    quickReplies: [
                        { label: "Monteverde", value: "WhatsApp Monteverde" },
                        { label: "Valle de las Flores", value: "WhatsApp Flores" },
                        { label: "Providencia", value: "WhatsApp Providencia" },
                    ]
                };
            }

            const systemPrompt = `Eres un asistente virtual amigable y servicial para "Marketa Mía", un minisuper. Tu objetivo es responder preguntas de los clientes basándote ÚNICAMENTE en la siguiente información. No inventes datos. Si te piden contactar por WhatsApp o información de contacto, responde preguntando a cuál de las tres sucursales (Monteverde, Valle de las Flores o Providencia) desean contactar.

            **Información de Sucursales:**
            - **Monteverde:** Dirección: BOULEVARD SENDEROS DE MONTEVERDE 25 LOCALES 3 Y 4, 45646 JALISCO. Teléfono: 33 3815 9036
            - **Valle de las Flores:** Dirección: LOPEZ MATEOS SUR 111111 VALLE DE LAS FLORES, 45640, JALISCO. Teléfono: 33 2095 8489
            - **Providencia:** Dirección: AV PABLO NERUDA #2120 COL PROVIDENCIA JALISCO. Teléfono: 33 3948 0011

            **Información General:**
            - **Horarios:** No tenemos horarios específicos por sucursal, el horario general es de 8am a 9pm.
            - **Productos:** Frutas, verduras, abarrotes, carnes, lácteos, limpieza.
            - **Pagos:** Efectivo, tarjetas de crédito/débito y vales de despensa.
            `;

            const apiKey = "AIzaSyD4hkCvFV90I56MXVy0jibpa0iZNlXSIuo";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            
            const payload = { contents: [{ parts: [{ text: systemPrompt + "\n\nPregunta del cliente: " + userMessage }] }] };

            try {
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) return { message: "Lo siento, estoy teniendo problemas. Intenta de nuevo.", quickReplies: [] };
                const result = await response.json();
                const text = result.candidates[0].content.parts[0].text;
                return { message: text, quickReplies: [] };
            } catch (error) {
                return { message: "Lo siento, ocurrió un error.", quickReplies: [] };
            }
        };

        const handleUserInput = async (userInput, isQuickReply = false) => {
            if (!userInput) return;
            if (!isQuickReply) {
                addMessage(`<p>${userInput}</p>`, 'user');
            }
            chatInput.value = '';
            showTypingIndicator();

            const botResponse = await getBotResponse(userInput);
            
            removeTypingIndicator();
            addMessage(botResponse.message, 'bot', botResponse.quickReplies);
        };

        chatForm.addEventListener('submit', (e) => {
            e.preventDefault();
            handleUserInput(chatInput.value.trim());
        });

        const showInitialMessage = () => {
            chatMessages.innerHTML = ''; 
            addMessage(
                "¡Hola! Soy el asistente de Marketa Mía. ¿En qué puedo ayudarte?",
                'bot',
                [
                    { label: "Ver Sucursales", value: "dime las sucursales" },
                    { label: "Horarios", value: "cuál es el horario" },
                    { label: "Contactar por WhatsApp", value: "quiero contactar por whatsapp" }
                ]
            );
        };
        
        showInitialMessage();

    </script>
</body>
</html>
